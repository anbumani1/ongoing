<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:html="http://www.w3.org/1999/xhtml">
    <Dialog id="notesDialog" title="ðŸ“ My Notes" contentWidth="1400px" contentHeight="900px" resizable="true" class="notion-dialog">
        <content>
            <HBox id="notesMainContainer" class="sapUiNoMargin notion-main-container">
                <!-- Clean Sidebar -->
                <VBox id="notesSidebar" width="320px" class="notion-sidebar">
                    <!-- Header with New Button -->
                    <HBox id="sidebarHeader" justifyContent="SpaceBetween" alignItems="Center" class="notion-sidebar-header">
                        <Title id="sidebarTitle" text="My Notes" level="H4" class="notion-sidebar-title"/>
                        <Button id="addNoteBtn"
                                text="+ New"
                                type="Emphasized"
                                press="onAddNote"
                                class="notion-new-btn"/>
                    </HBox>

                    <!-- Search -->
                    <SearchField id="notesSearch"
                                placeholder="Search notes..."
                                width="100%"
                                class="notion-search"
                                liveChange="onSearchNotes"/>

                    <!-- Notes List -->
                    <List id="notesList"
                          items="{/notes}"
                          mode="SingleSelect"
                          selectionChange="onNoteSelect"
                          class="notion-notes-list"
                          noDataText="No notes yet. Click '+ New' to get started!">
                        <CustomListItem id="noteListItem" type="Active" class="notion-note-item">
                            <content>
                                <VBox id="noteItemBox" class="notion-note-content">
                                    <Text id="noteItemTitle"
                                          text="{title}"
                                          class="notion-note-title"
                                          maxLines="1"/>
                                    <Text id="noteItemPreview"
                                          text="{preview}"
                                          maxLines="2"
                                          class="notion-note-preview"/>
                                    <Text id="noteItemDate" text="{lastModified}" class="notion-date"/>
                                </VBox>
                            </content>
                            <customData>
                                <core:CustomData id="noteData" key="noteId" value="{id}"/>
                            </customData>
                        </CustomListItem>
                    </List>
                </VBox>

                <!-- Main Editor Area -->
                <VBox id="editorArea" class="notion-editor-area">
                    <!-- Welcome State (when no note selected) -->
                    <VBox id="welcomeState" visible="{= !${/currentNote/id}}" class="notion-welcome-state">
                        <core:Icon id="welcomeStateIcon" src="sap-icon://document-text" size="4rem" color="#ddd" class="notion-welcome-icon"/>
                        <Title id="welcomeStateTitle" text="Select a note to start editing" level="H3" class="notion-welcome-title"/>
                        <Text id="welcomeStateText" text="Choose a note from the sidebar or create a new one." class="notion-welcome-text"/>
                        <Button id="welcomeStateCreateBtn" text="+ Create Your First Note"
                                type="Emphasized"
                                press="onAddNote"
                                class="notion-welcome-btn"/>
                    </VBox>

                    <!-- Editor State (when note is selected) -->
                    <VBox id="editorState" visible="{= !!${/currentNote/id}}" class="notion-editor-state">
                        <!-- Note Title -->
                        <Input id="noteTitleInput"
                               value="{/currentNote/title}"
                               placeholder="Untitled"
                               class="notion-title-input"
                               liveChange="onTitleChange"/>

                        <!-- Simple Toolbar -->
                        <HBox id="simpleToolbar" alignItems="Center" class="notion-simple-toolbar">
                            <Button id="addTextBtn" text="Text" icon="sap-icon://text" type="Default" press="onAddParagraph" class="notion-tool-btn"/>
                            <Button id="addHeadingBtn" text="Heading" icon="sap-icon://header" type="Default" press="onAddHeading" class="notion-tool-btn"/>
                            <Button id="addListBtn" text="List" icon="sap-icon://list" type="Default" press="onAddList" class="notion-tool-btn"/>
                            <Button id="addTodoBtn" text="Todo" icon="sap-icon://task" type="Default" press="onAddTodo" class="notion-tool-btn"/>
                            <ToolbarSpacer id="toolbarSpacer"/>
                            <Text id="autoSaveStatus" text="âœ… Saved" class="notion-save-status"/>
                        </HBox>

                        <!-- Content Area -->
                        <ScrollContainer id="contentScrollContainer" height="600px" class="notion-content-area">
                            <VBox id="contentContainer" class="notion-content-container">
                                <!-- Dynamic Blocks Container -->
                                <VBox id="dynamicBlocksContainer" class="notion-blocks">
                                    <!-- Blocks will be rendered here -->
                                </VBox>

                                <!-- Add Content Button -->
                                <Button id="addContentBtn"
                                        text="+ Add content"
                                        type="Transparent"
                                        press="onAddBlock"
                                        class="notion-add-content-btn"/>
                            </VBox>
                        </ScrollContainer>

                        <!-- Bottom Actions -->
                        <HBox id="bottomActions" justifyContent="SpaceBetween" alignItems="Center" class="notion-bottom-actions">
                            <HBox id="leftActions" alignItems="Center">
                                <Text id="wordCountDisplay" text="{/currentNote/wordCount} words" class="notion-word-count"/>
                                <Text id="lastModifiedDisplay" text="Last edited {/currentNote/lastModified}" class="notion-last-modified"/>
                            </HBox>
                            <HBox id="rightActions" alignItems="Center">
                                <Button id="deleteNoteBtn"
                                        icon="sap-icon://delete"
                                        type="Transparent"
                                        press="onDeleteNote"
                                        tooltip="Delete note"
                                        class="notion-delete-btn"/>
                            </HBox>
                        </HBox>
                    </VBox>
                </VBox>
            </HBox>
        </content>
        <buttons>
            <Button id="closeNotesBtn" text="Close" press="onCloseNotesDialog"/>
        </buttons>
    </Dialog>
</core:FragmentDefinition>
